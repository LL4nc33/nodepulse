<%- include('../partials/header', { currentPath: '/nodes' }) %>

<div class="app-layout">
  <%- include('../partials/side-panel') %>

  <main class="main-panel">

<div class="page-header-compact">
  <div class="page-header-left">
    <nav class="breadcrumb-inline" aria-label="Breadcrumb">
      <a href="/nodes">Nodes</a> / <span><%= node.name %></span>
    </nav>
    <h1>
      <span class="status-dot <%= node.online ? 'online' : 'offline' %>"
            aria-label="Status: <%= node.online ? 'Online' : 'Offline' %>"></span>
      <%= node.name %>
    </h1>
  </div>
  <div class="page-actions">
    <button class="btn btn-primary" id="btn-test" onclick="testConnection(<%= node.id %>)">
      <span class="btn-text">SSH Test</span>
      <span class="btn-loading"><span class="spinner"></span> Teste...</span>
    </button>
    <button class="btn btn-secondary" id="btn-discover" onclick="runDiscovery(<%= node.id %>)">
      <span class="btn-text">Discovery</span>
      <span class="btn-loading"><span class="spinner"></span> Scanne...</span>
    </button>
    <a href="/nodes/<%= node.id %>/edit" class="btn">Bearbeiten</a>
  </div>
</div>

<div id="test-result" class="alert" role="alert" aria-live="polite" style="display: none;"></div>

<!-- Tab Navigation (mit SVG-Icons) -->
<%- include('../partials/node-detail/tabs-navigation') %>

<!-- Tab Contents -->
<%- include('../partials/node-detail/overview-tab') %>

<% if (discovery && discovery.has_docker) { %>
  <%- include('../partials/node-detail/docker-tab') %>
<% } %>

<% if (discovery && discovery.is_proxmox_host) { %>
  <%- include('../partials/node-detail/proxmox-tab') %>
<% } %>

<% if (discovery && discovery.has_systemd) { %>
  <%- include('../partials/node-detail/services-tab') %>
<% } %>

<%- include('../partials/node-detail/network-tab') %>

<!-- Modals -->
<%- include('../partials/node-detail/modals') %>

  </main>

  <!-- Terminal Bottom Panel (außerhalb main-panel) -->
  <%- include('../partials/node-detail/terminal-panel') %>
</div>

<!-- Node ID für JavaScript (muss VOR detail-page.js geladen werden) -->
<script>
  var nodeId = <%= node.id %>;
  var nodeName = '<%= node.name.replace(/'/g, "\\'") %>';
</script>

<!-- External JavaScript -->
<script src="/static/js/detail-page.js?v=4.2"></script>

<%- include('../partials/footer') %>
