<%- include('../partials/header', { currentPath: '/nodes' }) %>

<div class="app-layout">
  <%- include('../partials/side-panel') %>

  <main class="main-panel">

<nav class="breadcrumb" aria-label="Breadcrumb">
  <a href="/nodes">Nodes</a> / <a href="/nodes/<%= node.id %>"><%= node.name %></a> / <span>Bearbeiten</span>
</nav>

<div class="page-header">
  <h1><%= node.name %> bearbeiten</h1>
</div>

<% if (error) { %>
  <div class="alert alert-error" role="alert"><%= error %></div>
<% } %>

<form method="POST" action="/nodes/<%= node.id %>/edit" class="form">
  <div class="form-group">
    <label for="name">Name *</label>
    <input type="text" id="name" name="name"
           value="<%= node.name %>"
           required
           maxlength="255">
  </div>

  <div class="form-group">
    <label for="host">Host *</label>
    <input type="text" id="host" name="host"
           value="<%= node.host %>"
           required
           maxlength="255">
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="ssh_user">SSH User *</label>
      <input type="text" id="ssh_user" name="ssh_user"
             value="<%= node.ssh_user %>"
             required
             maxlength="64">
    </div>
    <div class="form-group">
      <label for="ssh_port">SSH Port</label>
      <input type="number" id="ssh_port" name="ssh_port"
             value="<%= node.ssh_port %>"
             min="1" max="65535">
    </div>
  </div>

  <div class="form-group">
    <label for="ssh_password">SSH Passwort</label>
    <input type="password" id="ssh_password" name="ssh_password"
           value=""
           autocomplete="new-password"
           placeholder="<%= node.ssh_password ? '••••••••' : 'Kein Passwort gesetzt' %>">
    <small>Leer lassen um bestehendes Passwort zu behalten</small>
  </div>

  <div class="form-group">
    <label for="ssh_key_path">SSH Key Pfad</label>
    <input type="text" id="ssh_key_path" name="ssh_key_path"
           value="<%= node.ssh_key_path || '' %>">
  </div>

  <div class="form-row">
    <div class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" name="monitoring_enabled" <%= node.monitoring_enabled ? 'checked' : '' %>>
        Monitoring aktiv
      </label>
    </div>
    <div class="form-group">
      <label for="monitoring_interval">Monitoring Interval (Sekunden)</label>
      <input type="number" id="monitoring_interval" name="monitoring_interval"
             value="<%= node.monitoring_interval %>"
             min="5" max="3600">
    </div>
  </div>

  <div class="form-group">
    <label for="notes">Notizen</label>
    <textarea id="notes" name="notes" rows="4"><%= node.notes || '' %></textarea>
  </div>

  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Speichern</button>
    <a href="/nodes/<%= node.id %>" class="btn">Abbrechen</a>
  </div>
</form>

<!-- Danger Zone: Delete Node -->
<div class="danger-zone">
  <h3>Gefahrenzone</h3>
  <p>Diese Aktion kann nicht rueckgaengig gemacht werden.</p>
  <form method="POST" action="/nodes/<%= node.id %>/delete" id="deleteForm"
        onsubmit="return confirm('Bist du sicher, dass du den Node &quot;<%= node.name %>&quot; loeschen moechtest? Alle zugehoerigen Daten (Stats, Hardware-Info, Discovery) werden ebenfalls geloescht.');">
    <button type="submit" class="btn btn-danger">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        <line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>
      </svg>
      Node loeschen
    </button>
  </form>
</div>

  </main>
</div>

<%- include('../partials/footer') %>
