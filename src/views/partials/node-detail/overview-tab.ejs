<!-- Overview Tab - Proxmox VE Style -->
<div class="tab-content active" id="tab-overview">
  <!-- Hero Metrics Section (Proxmox-Style) -->
  <div class="hero-metrics">
    <%
      // Helper function für Bytes-Formatierung
      function formatBytesLocal(bytes) {
        if (!bytes || bytes === 0) return '0 B';
        var sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        var i = Math.floor(Math.log(bytes) / Math.log(1024));
        return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
      }

      // CPU-Temperaturen extrahieren
      var cpuTemps = [];
      try {
        var allThermals = JSON.parse((hardware && hardware.thermal_json) || '[]');
        cpuTemps = allThermals.filter(function(s) {
          var name = (s.name || '').toLowerCase();
          var label = (s.label || '').toLowerCase();
          return name.indexOf('cpu') !== -1 || name.indexOf('coretemp') !== -1 ||
                 name.indexOf('k10temp') !== -1 || label.indexOf('package') !== -1 ||
                 label.indexOf('tctl') !== -1;
        });
      } catch(e) {}

      var cpuPercent = (typeof currentStats !== 'undefined' && currentStats) ? currentStats.cpu_percent : null;
      var ramPercent = (typeof currentStats !== 'undefined' && currentStats) ? currentStats.ram_percent : null;
      var diskPercent = (typeof currentStats !== 'undefined' && currentStats) ? currentStats.disk_percent : null;
      var isOffline = !node.online;
    %>

    <!-- CPU Card -->
    <div class="hero-metric-card <%= isOffline ? 'offline' : (cpuPercent >= 90 ? 'critical' : (cpuPercent >= 70 ? 'warning' : '')) %>">
      <div class="hero-metric-header">
        <svg class="hero-metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="4" y="4" width="16" height="16" rx="2"/>
          <rect x="9" y="9" width="6" height="6"/>
          <line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/>
          <line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/>
          <line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/>
          <line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/>
        </svg>
        <span class="hero-metric-title">CPU</span>
        <% if (cpuTemps.length > 0 && cpuTemps[0].temp_c) { %>
          <span class="hero-metric-temp <%= cpuTemps[0].temp_c >= 80 ? 'critical' : (cpuTemps[0].temp_c >= 60 ? 'warning' : '') %>" id="cpu-temp">
            <%= cpuTemps[0].temp_c.toFixed(0) %>&deg;C
          </span>
        <% } %>
      </div>
      <div class="hero-metric-body">
        <div class="hero-metric-value">
          <% if (isOffline) { %>
            <span class="offline-text">Offline</span>
          <% } else if (cpuPercent !== null) { %>
            <span class="value-large <%= cpuPercent >= 90 ? 'critical' : (cpuPercent >= 70 ? 'warning' : '') %>"><%= Math.round(cpuPercent) %>%</span>
          <% } else { %>
            <span class="no-data">-</span>
          <% } %>
        </div>
        <div class="hero-metric-sparkline">
          <canvas id="sparkline-cpu" width="80" height="32"></canvas>
        </div>
      </div>
      <div class="hero-metric-bar">
        <div class="hero-metric-fill <%= cpuPercent >= 90 ? 'critical' : (cpuPercent >= 70 ? 'warning' : 'ok') %>"
             style="width: <%= isOffline ? 0 : Math.min(cpuPercent || 0, 100) %>%"></div>
      </div>
      <div class="hero-metric-details">
        <% if (hardware) { %>
          <% if (hardware.cpu_cores && hardware.cpu_threads) { %>
            <span><%= hardware.cpu_cores %>C / <%= hardware.cpu_threads %>T</span>
          <% } else if (hardware.cpu_cores) { %>
            <span><%= hardware.cpu_cores %> Cores</span>
          <% } %>
          <% if (hardware.cpu_max_mhz) { %>
            <span class="hero-metric-freq"><%= hardware.cpu_max_mhz >= 1000 ? (hardware.cpu_max_mhz / 1000).toFixed(1) + ' GHz' : hardware.cpu_max_mhz + ' MHz' %></span>
          <% } %>
        <% } %>
        <% if (hardware && hardware.cpu_model) { %>
          <span class="hero-metric-subtext"><%= hardware.cpu_model.substring(0, 30) %></span>
        <% } %>
      </div>
    </div>

    <!-- Memory Card -->
    <div class="hero-metric-card <%= isOffline ? 'offline' : (ramPercent >= 90 ? 'critical' : (ramPercent >= 75 ? 'warning' : '')) %>">
      <div class="hero-metric-header">
        <svg class="hero-metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="6" width="20" height="12" rx="2"/>
          <line x1="6" y1="10" x2="6" y2="14"/>
          <line x1="10" y1="10" x2="10" y2="14"/>
          <line x1="14" y1="10" x2="14" y2="14"/>
          <line x1="18" y1="10" x2="18" y2="14"/>
        </svg>
        <span class="hero-metric-title">Memory</span>
      </div>
      <div class="hero-metric-body">
        <div class="hero-metric-value">
          <% if (isOffline) { %>
            <span class="offline-text">Offline</span>
          <% } else if (ramPercent !== null) { %>
            <span class="value-large <%= ramPercent >= 90 ? 'critical' : (ramPercent >= 75 ? 'warning' : '') %>"><%= Math.round(ramPercent) %>%</span>
          <% } else { %>
            <span class="no-data">-</span>
          <% } %>
        </div>
        <div class="hero-metric-sparkline">
          <canvas id="sparkline-ram" width="80" height="32"></canvas>
        </div>
      </div>
      <div class="hero-metric-bar">
        <div class="hero-metric-fill <%= ramPercent >= 90 ? 'critical' : (ramPercent >= 75 ? 'warning' : 'ok') %>"
             style="width: <%= isOffline ? 0 : Math.min(ramPercent || 0, 100) %>%"></div>
      </div>
      <div class="hero-metric-details">
        <% if (currentStats && currentStats.ram_used_bytes && hardware && hardware.ram_total_bytes) { %>
          <span><%= formatBytesLocal(currentStats.ram_used_bytes) %> / <%= formatBytesLocal(hardware.ram_total_bytes) %></span>
        <% } else if (hardware && hardware.ram_total_bytes) { %>
          <span><%= formatBytesLocal(hardware.ram_total_bytes) %> Total</span>
        <% } %>
        <% if (hardware && hardware.ram_type) { %>
          <span class="hero-metric-subtext"><%= hardware.ram_type %></span>
        <% } %>
      </div>
    </div>

    <!-- Storage Card -->
    <div class="hero-metric-card <%= isOffline ? 'offline' : (diskPercent >= 90 ? 'critical' : (diskPercent >= 80 ? 'warning' : '')) %>">
      <div class="hero-metric-header">
        <svg class="hero-metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <ellipse cx="12" cy="5" rx="9" ry="3"/>
          <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
          <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
        </svg>
        <span class="hero-metric-title">Storage</span>
      </div>
      <div class="hero-metric-body">
        <div class="hero-metric-value">
          <% if (isOffline) { %>
            <span class="offline-text">Offline</span>
          <% } else if (diskPercent !== null) { %>
            <span class="value-large <%= diskPercent >= 90 ? 'critical' : (diskPercent >= 80 ? 'warning' : '') %>"><%= Math.round(diskPercent) %>%</span>
          <% } else { %>
            <span class="no-data">-</span>
          <% } %>
        </div>
        <div class="hero-metric-sparkline">
          <canvas id="sparkline-disk" width="80" height="32"></canvas>
        </div>
      </div>
      <div class="hero-metric-bar">
        <div class="hero-metric-fill <%= diskPercent >= 90 ? 'critical' : (diskPercent >= 80 ? 'warning' : 'ok') %>"
             style="width: <%= isOffline ? 0 : Math.min(diskPercent || 0, 100) %>%"></div>
      </div>
      <div class="hero-metric-details">
        <% if (currentStats && currentStats.disk_used_bytes && currentStats.disk_total_bytes) { %>
          <span><%= formatBytesLocal(currentStats.disk_used_bytes) %> / <%= formatBytesLocal(currentStats.disk_total_bytes) %></span>
        <% } %>
      </div>
    </div>

    <!-- Network Card -->
    <div class="hero-metric-card <%= isOffline ? 'offline' : '' %>">
      <div class="hero-metric-header">
        <svg class="hero-metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12.55a11 11 0 0 1 14.08 0"/>
          <path d="M1.42 9a16 16 0 0 1 21.16 0"/>
          <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/>
          <line x1="12" y1="20" x2="12.01" y2="20"/>
        </svg>
        <span class="hero-metric-title">Network</span>
        <% if (currentStats && currentStats.uptime_seconds) { %>
          <%
            var days = Math.floor(currentStats.uptime_seconds / 86400);
            var hours = Math.floor((currentStats.uptime_seconds % 86400) / 3600);
            var mins = Math.floor((currentStats.uptime_seconds % 3600) / 60);
          %>
          <span class="hero-metric-uptime" title="Uptime">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
            </svg>
            <%= days %>d <%= hours %>h
          </span>
        <% } %>
      </div>
      <div class="hero-metric-value hero-metric-network">
        <% if (isOffline) { %>
          <span class="offline-text">Offline</span>
        <% } else { %>
          <div class="network-stats">
            <span class="net-rx"><span class="net-arrow">↓</span> <span class="net-rate">-</span></span>
            <span class="net-tx"><span class="net-arrow">↑</span> <span class="net-rate">-</span></span>
          </div>
        <% } %>
      </div>
      <div class="hero-metric-details">
        <span class="hero-metric-connection">
          <span class="status-dot <%= node.online ? 'online' : 'offline' %>"></span>
          <span class="mono"><%= node.host %>:<%= node.ssh_port %></span>
          <span class="hero-metric-subtext"><%= node.ssh_user %>@</span>
        </span>
      </div>
    </div>
  </div>

  <!-- Tags Strip (falls vorhanden) -->
  <% if (tags.length > 0) { %>
  <div class="tags-strip">
    <% tags.forEach(function(tag) { %>
      <span class="tag-mini" style="background-color: <%= tag.color %>"><%= tag.name %></span>
    <% }); %>
  </div>
  <% } %>

  <% if (node.notes) { %>
    <div class="notes-strip">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
        <polyline points="14 2 14 8 20 8"/>
        <line x1="16" y1="13" x2="8" y2="13"/>
        <line x1="16" y1="17" x2="8" y2="17"/>
      </svg>
      <span><%= node.notes %></span>
    </div>
  <% } %>

  <!-- Hardware Section (Collapsible) -->
  <div class="overview-section collapsible">
    <h2 class="section-header" onclick="toggleSection(this)">
      <span class="section-toggle"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg></span>
      Hardware Details
    </h2>
    <div class="section-content">
      <% if (!hardware) { %>
        <div class="empty-state compact">
          <p>Keine Hardware-Daten vorhanden.</p>
          <button class="btn btn-primary btn-sm btn-discover-secondary" onclick="runDiscovery(<%= node.id %>)">
            <span class="btn-text">Discovery starten</span>
            <span class="btn-loading"><span class="spinner"></span></span>
          </button>
        </div>
      <% } else { %>
        <%
          var disks = [];
          try { disks = JSON.parse(hardware.disks_json || '[]'); } catch(e) {}
          var thermalSensors = [];
          try { thermalSensors = JSON.parse(hardware.thermal_json || '[]'); } catch(e) {}
          var powerSensors = [];
          try { powerSensors = JSON.parse(hardware.power_json || '[]'); } catch(e) {}
        %>
        <div class="hardware-strip">
          <!-- CPU -->
          <div class="hardware-strip-item">
            <span class="hardware-strip-label">CPU</span>
            <span class="hardware-strip-value"><%= hardware.cpu_model || '-' %></span>
            <span class="hardware-strip-sub"><%= hardware.cpu_cores || '-' %>/<%= hardware.cpu_threads || '-' %> Cores · <%= hardware.cpu_arch || '-' %></span>
          </div>
          <!-- RAM -->
          <div class="hardware-strip-item">
            <span class="hardware-strip-label">RAM</span>
            <span class="hardware-strip-value"><%= hardware.ram_total_bytes ? formatBytesLocal(hardware.ram_total_bytes) : '-' %></span>
            <span class="hardware-strip-sub"><%= hardware.ram_type || 'DDR' %></span>
          </div>
          <!-- Disks -->
          <div class="hardware-strip-item">
            <span class="hardware-strip-label">Storage</span>
            <span class="hardware-strip-value"><%= disks.length %> Disk<%= disks.length !== 1 ? 's' : '' %></span>
            <span class="hardware-strip-sub"><% if (disks.length > 0) { %><%= disks.slice(0, 3).map(function(d) { return d.name || d.NAME; }).join(', ') %><% if (disks.length > 3) { %>, …<% } %><% } else { %>-<% } %></span>
          </div>
          <!-- System -->
          <div class="hardware-strip-item">
            <span class="hardware-strip-label">System</span>
            <span class="hardware-strip-value"><%= hardware.system_manufacturer || '-' %></span>
            <span class="hardware-strip-sub"><%= hardware.system_product || '-' %></span>
          </div>
          <% if (thermalSensors.length > 0) { %>
          <!-- Temps -->
          <div class="hardware-strip-item">
            <span class="hardware-strip-label">Temps</span>
            <span class="hardware-strip-value hardware-strip-temps">
              <% thermalSensors.slice(0, 3).forEach(function(sensor) { %>
                <% if (sensor.temp_c !== null && sensor.temp_c !== undefined) { %>
                  <span class="temp-chip <%= sensor.temp_c >= 80 ? 'critical' : (sensor.temp_c >= 60 ? 'warning' : 'ok') %>" title="<%= sensor.label || sensor.name %>"><%= sensor.temp_c.toFixed(0) %>&deg;</span>
                <% } %>
              <% }); %>
            </span>
            <span class="hardware-strip-sub"><%= thermalSensors.slice(0, 3).map(function(s) { return (s.label || s.name || '').substring(0, 6); }).join(' · ') %></span>
          </div>
          <% } %>
          <% if (powerSensors.length > 0) { %>
          <!-- Power -->
          <div class="hardware-strip-item">
            <span class="hardware-strip-label">Power</span>
            <span class="hardware-strip-value"><%= powerSensors[0].power_w ? powerSensors[0].power_w.toFixed(0) + ' W' : '-' %></span>
            <span class="hardware-strip-sub"><%= (powerSensors[0].label || powerSensors[0].name || 'Total').substring(0, 10) %></span>
          </div>
          <% } %>
        </div>
      <% } %>
    </div>
  </div>

  <!-- Discovery Section (Collapsible) -->
  <div class="overview-section collapsible">
    <h2 class="section-header" onclick="toggleSection(this)">
      <span class="section-toggle"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg></span>
      Discovery & Umgebung
    </h2>
    <div class="section-content">
      <% if (!discovery) { %>
        <div class="empty-state compact">
          <p>Keine Discovery-Daten vorhanden.</p>
          <button class="btn btn-primary btn-sm btn-discover-secondary" onclick="runDiscovery(<%= node.id %>)">
            <span class="btn-text">Discovery starten</span>
            <span class="btn-loading"><span class="spinner"></span></span>
          </button>
        </div>
      <% } else { %>
        <div class="detail-grid compact-grid">
          <!-- OS Info -->
          <div class="detail-card compact">
            <h3>Betriebssystem</h3>
            <dl>
              <dt>Hostname</dt>
              <dd><%= discovery.hostname || '-' %></dd>
              <dt>OS</dt>
              <dd><%= discovery.os_name || '-' %></dd>
              <dt>Architektur</dt>
              <dd><%= discovery.arch || '-' %></dd>
              <dt>Virtualisierung</dt>
              <dd><%= discovery.virtualization || 'Bare Metal' %></dd>
            </dl>
          </div>

          <!-- Proxmox (wenn vorhanden) -->
          <% if (discovery.is_proxmox_host) { %>
            <div class="detail-card compact">
              <h3>Proxmox VE</h3>
              <dl>
                <dt>Version</dt>
                <dd><%= discovery.proxmox_version || '-' %></dd>
                <dt>Cluster</dt>
                <dd><%= discovery.is_proxmox_cluster ? 'Ja' : 'Standalone' %></dd>
                <% if (discovery.is_proxmox_cluster && discovery.proxmox_cluster_name) { %>
                  <dt>Cluster Name</dt>
                  <dd><%= discovery.proxmox_cluster_name %></dd>
                <% } %>
              </dl>
            </div>
          <% } %>

          <!-- Container Runtimes -->
          <div class="detail-card compact">
            <h3>Container & Runtimes</h3>
            <dl>
              <dt>Docker</dt>
              <dd>
                <% if (discovery.has_docker) { %>
                  <span class="badge badge-ok"><%= discovery.docker_version || 'Ja' %></span>
                <% } else { %>
                  <span class="badge badge-neutral">Nein</span>
                <% } %>
              </dd>
              <% if (discovery.has_podman) { %>
                <dt>Podman</dt>
                <dd><span class="badge badge-ok"><%= discovery.podman_version || 'Ja' %></span></dd>
              <% } %>
              <% if (discovery.is_raspberry_pi) { %>
                <dt>Raspberry Pi</dt>
                <dd><span class="badge badge-info"><%= discovery.raspberry_pi_model || 'Ja' %></span></dd>
              <% } %>
              <dt>Systemd</dt>
              <dd>
                <% if (discovery.has_systemd) { %>
                  <span class="badge badge-ok">Verfügbar</span>
                <% } else { %>
                  <span class="badge badge-neutral">Nein</span>
                <% } %>
              </dd>
            </dl>
          </div>

        </div>
      <% } %>
    </div>
  </div>

  <!-- System Health Section (Collapsible) - ProxMenux Style -->
  <div class="overview-section collapsible">
    <h2 class="section-header" onclick="toggleSection(this)">
      <span class="section-toggle"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg></span>
      System Health
      <% if (health && health.health_status) { %>
        <span class="badge badge-<%= health.health_status === 'healthy' ? 'ok' : (health.health_status === 'warning' ? 'warning' : 'critical') %>">
          <%= health.health_score || 100 %>%
        </span>
      <% } %>
      <% if (health && health.apt_updates > 0) { %>
        <span class="badge badge-warning"><%= health.apt_updates %> Updates</span>
      <% } %>
      <% if (health && health.reboot_required) { %>
        <span class="badge badge-critical">Reboot</span>
      <% } %>
    </h2>
    <div class="section-content">
      <% if (!health) { %>
        <div class="empty-state compact">
          <p>Noch kein Health-Check durchgefuehrt. Klicke oben auf <strong>Health</strong> um einen Check zu starten.</p>
        </div>
      <% } else { %>
        <!-- Health Score Overview -->
        <% if (health.health_issues) { %>
          <div class="health-issues-banner <%= health.health_status %>">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
            <span><%= health.health_issues %></span>
          </div>
        <% } %>

        <!-- Health Checks Grid (ProxMenux Style) -->
        <div class="health-checks-grid">
          <!-- CPU Temperature -->
          <div class="health-check-item <%= health.cpu_temp_status || 'unknown' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">CPU Temp</span>
              <span class="health-check-value"><%= health.cpu_temp > 0 ? health.cpu_temp + '°C' : 'N/A' %></span>
            </div>
            <div class="health-check-status <%= health.cpu_temp_status || 'unknown' %>"></div>
          </div>

          <!-- Load Average -->
          <div class="health-check-item <%= health.load_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Load Average</span>
              <span class="health-check-value"><%= health.load_1 ? health.load_1.toFixed(2) : '0.00' %></span>
            </div>
            <div class="health-check-status <%= health.load_status || 'ok' %>"></div>
          </div>

          <!-- Memory -->
          <div class="health-check-item <%= health.mem_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="6" width="20" height="12" rx="2"/>
                <line x1="6" y1="10" x2="6" y2="14"/><line x1="10" y1="10" x2="10" y2="14"/>
                <line x1="14" y1="10" x2="14" y2="14"/><line x1="18" y1="10" x2="18" y2="14"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Memory</span>
              <span class="health-check-value"><%= health.mem_percent || 0 %>%</span>
            </div>
            <div class="health-check-status <%= health.mem_status || 'ok' %>"></div>
          </div>

          <!-- Swap -->
          <div class="health-check-item <%= health.swap_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                <polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Swap</span>
              <span class="health-check-value"><%= health.swap_percent || 0 %>%</span>
            </div>
            <div class="health-check-status <%= health.swap_status || 'ok' %>"></div>
          </div>

          <!-- Disk -->
          <div class="health-check-item <%= health.disk_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Disk (root)</span>
              <span class="health-check-value"><%= health.disk_percent || 0 %>%</span>
            </div>
            <div class="health-check-status <%= health.disk_status || 'ok' %>"></div>
          </div>

          <!-- Failed Services -->
          <div class="health-check-item <%= health.services_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/>
                <line x1="12" y1="17" x2="12" y2="21"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Failed Services</span>
              <span class="health-check-value"><%= health.failed_services || 0 %></span>
            </div>
            <div class="health-check-status <%= health.services_status || 'ok' %>"></div>
          </div>

          <!-- Zombie Processes -->
          <div class="health-check-item <%= health.zombie_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><path d="M8 15h8"/><circle cx="9" cy="9" r="1"/><circle cx="15" cy="9" r="1"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Zombies</span>
              <span class="health-check-value"><%= health.zombie_processes || 0 %></span>
            </div>
            <div class="health-check-status <%= health.zombie_status || 'ok' %>"></div>
          </div>

          <!-- Time Sync -->
          <div class="health-check-item <%= health.time_status || 'unknown' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Time Sync</span>
              <span class="health-check-value"><%= health.time_sync || 'Unknown' %></span>
            </div>
            <div class="health-check-status <%= health.time_status || 'unknown' %>"></div>
          </div>

          <!-- Network -->
          <div class="health-check-item <%= health.net_status || 'unknown' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/>
                <path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Network</span>
              <span class="health-check-value"><%= health.net_gateway || 'N/A' %></span>
            </div>
            <div class="health-check-status <%= health.net_status || 'unknown' %>"></div>
          </div>

          <!-- Updates -->
          <div class="health-check-item <%= health.apt_status || 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Updates</span>
              <span class="health-check-value"><%= health.apt_updates || 0 %><% if (health.apt_security > 0) { %> (<%= health.apt_security %> sec)<% } %></span>
            </div>
            <div class="health-check-status <%= health.apt_status || 'ok' %>"></div>
          </div>

          <!-- Reboot Required -->
          <div class="health-check-item <%= health.reboot_required ? 'warning' : 'ok' %>">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Reboot</span>
              <span class="health-check-value"><%= health.reboot_required ? 'Required' : 'Not needed' %></span>
            </div>
            <div class="health-check-status <%= health.reboot_required ? 'warning' : 'ok' %>"></div>
          </div>

          <!-- Kernel -->
          <div class="health-check-item ok">
            <div class="health-check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/>
              </svg>
            </div>
            <div class="health-check-info">
              <span class="health-check-label">Kernel</span>
              <span class="health-check-value"><%= health.kernel_version ? health.kernel_version.substring(0, 20) : 'N/A' %></span>
            </div>
            <div class="health-check-status ok"></div>
          </div>
        </div>

        <!-- System Details (collapsed by default) -->
        <details class="health-details">
          <summary>System Details</summary>
          <div class="detail-grid compact-grid">
            <!-- System Info -->
            <div class="detail-card compact">
              <h3>System</h3>
              <dl>
                <dt>Kernel</dt>
                <dd><%= health.kernel_version || '-' %></dd>
                <dt>Letzter Boot</dt>
                <dd><%= health.last_boot || '-' %></dd>
                <dt>Load (1/5/15)</dt>
                <dd><%= health.load_1 ? health.load_1.toFixed(2) : '0' %> / <%= health.load_5 ? health.load_5.toFixed(2) : '0' %> / <%= health.load_15 ? health.load_15.toFixed(2) : '0' %></dd>
              </dl>
            </div>

            <% if (health.pve_version) { %>
            <!-- Proxmox -->
            <div class="detail-card compact">
              <h3>Proxmox</h3>
              <dl>
                <dt>Version</dt>
                <dd><%= health.pve_version %></dd>
                <dt>Repository</dt>
                <dd>
                  <% if (health.pve_repo === 'enterprise') { %>
                    <span class="badge badge-warning">Enterprise</span>
                  <% } else if (health.pve_repo === 'no-subscription') { %>
                    <span class="badge badge-ok">No-Subscription</span>
                  <% } else { %>
                    <span class="badge badge-neutral">Unbekannt</span>
                  <% } %>
                </dd>
              </dl>
            </div>
            <% } %>

            <% if (health.failed_services > 0 && health.failed_services_list) { %>
            <!-- Failed Services Detail -->
            <div class="detail-card compact">
              <h3>Failed Services</h3>
              <div class="failed-services-list">
                <% health.failed_services_list.split(',').forEach(function(svc) { if(svc) { %>
                  <span class="badge badge-critical"><%= svc.trim() %></span>
                <% }}); %>
              </div>
            </div>
            <% } %>
          </div>
        </details>

        <!-- Actions -->
        <div class="health-actions">
          <button class="btn btn-secondary btn-sm btn-health-check" onclick="runHealthCheck(<%= node.id %>)">
            <span class="btn-text">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
              </svg>
              Erneut pruefen
            </span>
            <span class="btn-loading"><span class="spinner"></span></span>
          </button>
          <% if (health.apt_updates > 0) { %>
            <button class="btn btn-primary btn-sm" onclick="runUpgrade(<%= node.id %>)">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Upgrade (<%= health.apt_updates %>)
            </button>
          <% } %>
          <% if (health.pve_version && health.pve_repo === 'enterprise') { %>
            <button class="btn btn-warning btn-sm" onclick="switchProxmoxRepo(<%= node.id %>, 'no-subscription')">
              No-Subscription
            </button>
          <% } %>
          <small class="text-muted">Zuletzt: <%= health.checked_at || '-' %></small>
        </div>
      <% } %>
    </div>
  </div>
</div>
